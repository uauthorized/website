<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget Planner - Nicolas Miret</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Hybrid with Dark Mode -->
    <!-- Application Structure Plan: A single-page application with a static salary overview at the top, followed by two switchable views: Dashboard and Excel. Both views feature an 'Apply to All Months' toggle for efficient editing. -->
    <!-- Visualization & Content Choices: A static HTML table displays salary data. The interactive parts (donut chart, input tables) remain, with event handling logic that respects the 'Apply to All' toggle to update the central data store. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --bg-color: #FDFBF8; --text-color: #3f3f46; --text-color-light: #52525b; --text-color-strong: #18181b;
            --card-bg: #FFFFFF; --border-color: #e5e7eb; --input-bg: #FFFFFF; --input-border: #d1d5db;
            --header-bg: #f9fafb; --header-text: #374151; --excel-bg: #f8f9fa; --excel-text: #212529;
            --excel-header-bg: #e9ecef; --excel-border: #dee2e6; --excel-output-bg: #f8f9fa; --toggle-bg: #e5e7eb;
        }
        html.dark {
            --bg-color: #18181b; --text-color: #d4d4d8; --text-color-light: #a1a1aa; --text-color-strong: #f4f4f5;
            --card-bg: #27272a; --border-color: #3f3f46; --input-bg: #3f3f46; --input-border: #52525b;
            --header-bg: #3f3f46; --header-text: #e4e4e7; --excel-bg: #18181b; --excel-text: #d4d4d8;
            --excel-header-bg: #3f3f46; --excel-border: #52525b; --excel-output-bg: #27272a; --toggle-bg: #3f3f46;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s, color 0.3s; }
        .main-container { max-width: 1600px; margin-left: auto; margin-right: auto; padding: 1rem; }
        .main-header, .main-title, .main-subtitle { color: var(--text-color-strong); }
        .card { background-color: var(--card-bg); border-radius: 0.75rem; border: 1px solid var(--border-color); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); transition: background-color 0.3s, border-color 0.3s; }
        .chart-container { position: relative; width: 100%; max-width: 450px; margin-left: auto; margin-right: auto; height: 40vh; max-height: 450px; }
        .excel-table, .salary-table { border-collapse: collapse; width: 100%; font-size: 0.875rem; }
        .excel-table th, .excel-table td, .salary-table th, .salary-table td { border: 1px solid var(--excel-border); padding: 0.5rem; text-align: left; vertical-align: top; transition: background-color 0.3s, border-color 0.3s; }
        .excel-table th, .salary-table th { background-color: var(--excel-header-bg); font-weight: 600; text-align: center; color: var(--excel-text); }
        .excel-table td, .salary-table td { color: var(--excel-text); }
        .input-field { width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid var(--input-border); background-color: var(--input-bg); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, background-color 0.3s, color 0.3s; -moz-appearance: textfield; }
        .input-field::-webkit-outer-spin-button, .input-field::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .input-field:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2); }
        .excel-input { padding: 0.25rem 0.5rem; border-radius: 0.25rem; }
        .output-cell { text-align: right; background-color: var(--excel-output-bg); font-weight: 500; }
        .table-header { background-color: var(--header-bg); color: var(--header-text); }
        .month-selector { padding: 0.5rem; border-radius: 0.5rem; border: 1px solid var(--input-border); background-color: var(--input-bg); color: var(--text-color); }
        .toggle-switch-label { cursor: pointer; }
        .toggle-switch-bg { width: 44px; height: 24px; border-radius: 9999px; background-color: var(--toggle-bg); position: relative; transition: background-color 0.2s ease-in-out; }
        .toggle-switch-bg::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; border-radius: 50%; background-color: white; transition: transform 0.2s ease-in-out; }
        .toggle-switch-input:checked + .toggle-switch-bg { background-color: #4f46e5; }
        .toggle-switch-input:checked + .toggle-switch-bg::after { transform: translateX(20px); }
    </style>
</head>
<body class="antialiased">
    <div class="main-container py-8 px-4 sm:px-6 lg:px-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold tracking-tight main-title">Personal Budget Planner</h1>
            <p class="mt-2 text-lg main-subtitle">By Nicolas Miret</p>
            <div class="mt-6 flex justify-center items-center space-x-4">
                <button id="view-toggle-btn" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors">Switch to Excel View</button>
                <button id="theme-toggle-btn" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </header>

        <section class="mb-12">
            <div class="card p-6">
                 <h2 class="text-xl font-semibold mb-4 text-center main-header">Salary Overview: Cybersecurity Engineer (Miami, FL)</h2>
                <div class="overflow-x-auto">
                    <table class="salary-table">
                        <thead>
                            <tr>
                                <th>Job Title</th>
                                <th>Hourly Wage</th>
                                <th>Monthly Salary</th>
                                <th>Annual Income</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Entry-Level Position</td>
                                <td class="text-right">$43.27</td>
                                <td class="text-right">$7,500.00</td>
                                <td class="text-right">$90,000.00</td>
                            </tr>
                            <tr class="font-semibold text-indigo-700 dark:text-indigo-400">
                                <td>Average Salary</td>
                                <td class="text-right">$55.29</td>
                                <td class="text-right">$9,583.33</td>
                                <td class="text-right">$115,000.00</td>
                            </tr>
                            <tr>
                                <td>Senior-Level Position</td>
                                <td class="text-right">$69.71</td>
                                <td class="text-right">$12,083.33</td>
                                <td class="text-right">$145,000.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <div id="dashboard-view">
            <main class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                         <h2 class="text-2xl font-semibold main-header">Interactive Monthly Budget</h2>
                         <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2 toggle-switch-label text-sm"><input type="checkbox" class="apply-all-toggle toggle-switch-input sr-only"><div class="toggle-switch-bg"></div>Apply to All Months</label>
                            <select id="month-selector" class="month-selector"></select>
                         </div>
                    </div>
                    <div class="card overflow-hidden">
                        <table class="w-full">
                            <tbody>
                                <tr class="bg-indigo-50 dark:bg-indigo-900/20">
                                    <td class="p-4 font-semibold text-indigo-800 dark:text-indigo-300 text-lg" colspan="2">Monthly Income (After Tax)</td>
                                    <td class="p-4"><input type="number" id="dashboard-monthly-income" class="input-field font-semibold text-lg"></td>
                                </tr>
                               <tr><td class="p-3 table-header font-semibold" colspan="3">Expenses</td></tr>
                               <tr><td class="p-4">Rent / Mortgage</td><td class="p-4"><input type="number" data-category="rent" class="dashboard-budget-input input-field"></td></tr>
                               <tr><td class="p-4">Utilities (Elec/Water)</td><td class="p-4"><input type="number" data-category="utilities" class="dashboard-budget-input input-field"></td></tr>
                               <tr><td class="p-4">Communications (Net/Phone)</td><td class="p-4"><input type="number" data-category="communications" class="dashboard-budget-input input-field"></td></tr>
                               <tr><td class="p-4">Transportation (Car/Ins/Gas)</td><td class="p-4"><input type="number" data-category="transportation" class="dashboard-budget-input input-field"></td></tr>
                               <tr><td class="p-4">Daily Living (Groceries/Ent/Gifts)</td><td class="p-4"><input type="number" data-category="living" class="dashboard-budget-input input-field"></td></tr>
                               <tr><td class="p-4">Financial (Debt/Savings)</td><td class="p-4"><input type="number" data-category="financial" class="dashboard-budget-input input-field"></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-semibold main-header mb-4">Financial Summary</h2>
                    <div class="space-y-6">
                        <div class="card p-6 text-center"><h3 id="total-expenses-label" class="text-md font-medium text-color-light"></h3><p id="total-expenses" class="text-4xl font-bold text-red-600 mt-1"></p></div>
                        <div class="card p-6 text-center"><h3 id="remaining-income-label" class="text-md font-medium text-color-light"></h3><p id="remaining-income" class="text-4xl font-bold text-green-600 mt-1"></p></div>
                        <div class="card p-6 text-center"><h3 class="text-md font-medium text-color-light">Projected Annual Savings</h3><p id="annual-savings" class="text-4xl font-bold text-blue-600 mt-1"></p></div>
                        <div class="card p-6">
                            <h3 id="chart-label" class="text-xl font-semibold text-center mb-4"></h3>
                            <div class="chart-container"><canvas id="expenseChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div id="excel-view" class="hidden">
             <div class="card p-4">
                <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                     <div class="flex items-center gap-4">
                         <label for="excel-monthly-income" class="font-semibold whitespace-nowrap">Monthly Income (After Tax):</label>
                         <input type="number" id="excel-monthly-income" class="input-field excel-input max-w-xs font-bold">
                     </div>
                     <label class="flex items-center gap-2 toggle-switch-label text-sm"><input type="checkbox" class="apply-all-toggle toggle-switch-input sr-only"><div class="toggle-switch-bg"></div>Apply to All Months</label>
                </div>
                 <h2 class="text-xl font-semibold mb-2">Living as a Cybersecurity Engineer</h2>
                <div class="overflow-x-auto">
                    <table class="excel-table">
                        <thead><tr><th>Month</th><th>Rent</th><th>Utilities</th><th>Internet</th><th>Telephone</th><th>Car Payment</th><th>Car Insurance</th><th>Gasoline</th><th>Groceries</th><th>Entertainment</th><th>Gifts</th><th>Debt</th><th>Savings</th><th>Total</th><th>Remaining</th><th>Cumulative</th><th>Annual Net</th></tr></thead>
                        <tbody id="budget-body"></tbody>
                        <tfoot>
                            <tr id="subtotals-row" class="font-bold"><td class="!text-left">Subtotal</td></tr>
                            <tr id="averages-row"><td class="!text-left">Average</td></tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- STATE & CONFIG ---
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const excelCategories = [ 'rent', 'utilities', 'internet', 'telephone', 'carPayment', 'carInsurance', 'gasoline', 'groceries', 'entertainment', 'gifts', 'debt', 'savings' ];
            const dashboardCategories = { rent: ['rent'], utilities: ['utilities'], communications: ['internet', 'telephone'], transportation: ['carPayment', 'carInsurance', 'gasoline'], living: ['groceries', 'entertainment', 'gifts'], financial: ['debt', 'savings'] };
            let budgetData = { monthlyIncome: 6800, expenses: [] }, currentView = 'dashboard', selectedMonthIndex = 0, applyToAllMonths = false;
            
            // --- UTILS ---
            const currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            const chartColors = { rent: '#6366f1', utilities: '#818cf8', communications: '#a5b4fc', transportation: '#34d399', living: '#6ee7b7', financial: '#a7f3d0' };

            // --- ELEMENTS ---
            const themeToggleButton = document.getElementById('theme-toggle-btn'), htmlEl = document.documentElement;
            const viewToggleButton = document.getElementById('view-toggle-btn'), dashboardView = document.getElementById('dashboard-view'), excelView = document.getElementById('excel-view');
            const allToggles = document.querySelectorAll('.apply-all-toggle');
            const dashboardIncomeInput = document.getElementById('dashboard-monthly-income'), excelIncomeInput = document.getElementById('excel-monthly-income');
            const monthSelector = document.getElementById('month-selector'), budgetBody = document.getElementById('budget-body');
            const totalExpensesEl = document.getElementById('total-expenses'), remainingIncomeEl = document.getElementById('remaining-income'), annualSavingsEl = document.getElementById('annual-savings');
            const totalExpensesLabel = document.getElementById('total-expenses-label'), remainingIncomeLabel = document.getElementById('remaining-income-label'), chartLabel = document.getElementById('chart-label');
            const subtotalsRow = document.getElementById('subtotals-row'), averagesRow = document.getElementById('averages-row');
            const ctx = document.getElementById('expenseChart').getContext('2d');
            let expenseChart;

            // --- INITIALIZATION ---
            function initializeData() {
                const baseExpenses = { rent: 2500, utilities: 200, internet: 80, telephone: 75, carPayment: 450, carInsurance: 200, gasoline: 300, groceries: 500, entertainment: 400, gifts: 100, debt: 150, savings: 500 };
                budgetData.expenses = Array(12).fill(null).map(() => ({ ...baseExpenses }));
            }
            initializeData();
            createExcelTable();
            populateMonthSelector();
            createChart();
            attachListeners();
            applyTheme(localStorage.getItem('theme') || 'light');
            syncAndRenderAll();

            // --- THEME ---
            function applyTheme(theme) { htmlEl.className = theme; document.getElementById('theme-icon-light').classList.toggle('hidden', theme === 'dark'); document.getElementById('theme-icon-dark').classList.toggle('hidden', theme !== 'dark'); updateChartTheme(); }
            function updateChartTheme() { if (expenseChart) { expenseChart.options = getChartOptions(); expenseChart.update(); } }
            
            // --- SYNC & RENDER ---
            function syncAndRenderAll() { renderDashboard(); renderExcel(); }

            // --- DASHBOARD ---
            function populateMonthSelector() { months.forEach((month, index) => { const option = new Option(month, index); monthSelector.appendChild(option); }); monthSelector.value = selectedMonthIndex; }
            function renderDashboard() {
                dashboardIncomeInput.value = budgetData.monthlyIncome;
                const monthName = months[selectedMonthIndex];
                totalExpensesLabel.textContent = `Total Expenses (${monthName})`;
                remainingIncomeLabel.textContent = `Remaining Income (${monthName})`;
                chartLabel.textContent = `Expense Breakdown (${monthName})`;

                const currentMonthExpenses = budgetData.expenses[selectedMonthIndex];
                let totalMonthlyExpenses = 0;
                const categoryTotals = {};
                for (const dashCat in dashboardCategories) {
                    categoryTotals[dashCat] = dashboardCategories[dashCat].reduce((sum, excelCat) => sum + currentMonthExpenses[excelCat], 0);
                    document.querySelector(`.dashboard-budget-input[data-category="${dashCat}"]`).value = categoryTotals[dashCat];
                    totalMonthlyExpenses += categoryTotals[dashCat];
                }
                
                remainingIncomeEl.classList.toggle('text-red-600', (budgetData.monthlyIncome - totalMonthlyExpenses) < 0);
                remainingIncomeEl.classList.toggle('text-green-600', (budgetData.monthlyIncome - totalMonthlyExpenses) >= 0);
                totalExpensesEl.textContent = currencyFormatter.format(totalMonthlyExpenses);
                remainingIncomeEl.textContent = currencyFormatter.format(budgetData.monthlyIncome - totalMonthlyExpenses);

                const totalAnnualSavings = budgetData.expenses.reduce((total, month) => {
                    const monthTotal = Object.values(month).reduce((sum, val) => sum + val, 0);
                    return total + (budgetData.monthlyIncome - monthTotal);
                }, 0);
                annualSavingsEl.textContent = currencyFormatter.format(totalAnnualSavings);
                updateChart(categoryTotals);
            }
            function getChartOptions() { const isDark = htmlEl.classList.contains('dark'); return { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { color: isDark ? '#d4d4d8' : '#3f3f46' } } } }; }
            function createChart() { expenseChart = new Chart(ctx, { type: 'doughnut', data: { labels: [], datasets: [{ data: [], backgroundColor: [], borderWidth: 2 }] }, options: getChartOptions() }); }
            function updateChart(totals) { if (!expenseChart) return; const labels = Object.keys(totals); expenseChart.data.labels = labels; expenseChart.data.datasets[0].data = Object.values(totals); expenseChart.data.datasets[0].backgroundColor = Object.values(dashboardCategories).map((_, i) => Object.values(chartColors)[i]); expenseChart.update(); }

            // --- EXCEL ---
            function createExcelTable() {
                let bodyHtml = '', subtotalCols = '', averageCols = '';
                months.forEach((month, monthIndex) => {
                    let rowHTML = `<td>${month}</td>`;
                    excelCategories.forEach(cat => { rowHTML += `<td><input type="number" class="input-field excel-input" data-month="${monthIndex}" data-category="${cat}"></td>`; });
                    rowHTML += `<td class="output-cell total-monthly"></td><td class="output-cell wages-left"></td><td class="output-cell yearly-cumulative"></td><td class="output-cell annual-after"></td>`;
                    bodyHtml += `<tr id="month-row-${monthIndex}">${rowHTML}</tr>`;
                });
                excelCategories.forEach(cat => { subtotalCols += `<td class="output-cell subtotal-cell" data-category="${cat}"></td>`; averageCols += `<td class="output-cell average-cell" data-category="${cat}"></td>`; });
                budgetBody.innerHTML = bodyHtml;
                subtotalsRow.innerHTML += subtotalCols + `<td class="output-cell subtotal-cell" data-category="total-monthly"></td><td colspan="3"></td>`;
                averagesRow.innerHTML += averageCols + `<td class="output-cell average-cell" data-category="total-monthly"></td><td colspan="3"></td>`;
            }
            function renderExcel() {
                excelIncomeInput.value = budgetData.monthlyIncome;
                let cumulativeYearly = 0; const subtotals = {}; excelCategories.forEach(c => subtotals[c] = 0); subtotals['total-monthly'] = 0;
                budgetData.expenses.forEach((monthExpenses, monthIndex) => {
                    const row = document.getElementById(`month-row-${monthIndex}`);
                    let monthTotal = 0;
                    excelCategories.forEach(cat => {
                        row.querySelector(`[data-category="${cat}"]`).value = monthExpenses[cat];
                        monthTotal += monthExpenses[cat];
                        subtotals[cat] += monthExpenses[cat];
                    });
                    cumulativeYearly += monthTotal; subtotals['total-monthly'] += monthTotal;
                    row.querySelector('.total-monthly').textContent = currencyFormatter.format(monthTotal);
                    row.querySelector('.wages-left').textContent = currencyFormatter.format(budgetData.monthlyIncome - monthTotal);
                    row.querySelector('.yearly-cumulative').textContent = currencyFormatter.format(cumulativeYearly);
                    row.querySelector('.annual-after').textContent = currencyFormatter.format((budgetData.monthlyIncome * 12) - cumulativeYearly);
                });
                document.querySelectorAll('.subtotal-cell').forEach(cell => cell.textContent = currencyFormatter.format(subtotals[cell.dataset.category]));
                document.querySelectorAll('.average-cell').forEach(cell => cell.textContent = currencyFormatter.format(subtotals[cell.dataset.category] / 12));
            }

            // --- EVENT HANDLERS ---
            function attachListeners() {
                themeToggleButton.addEventListener('click', () => { const newTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
                viewToggleButton.addEventListener('click', () => { currentView = (currentView === 'dashboard') ? 'excel' : 'dashboard'; dashboardView.classList.toggle('hidden'); excelView.classList.toggle('hidden'); viewToggleButton.textContent = (currentView === 'excel') ? 'Switch to Dashboard' : 'Switch to Excel'; syncAndRenderAll(); });
                
                allToggles.forEach(toggle => toggle.addEventListener('change', e => {
                    applyToAllMonths = e.target.checked;
                    allToggles.forEach(t => t.checked = applyToAllMonths);
                }));

                const handleIncomeChange = e => { budgetData.monthlyIncome = parseFloat(e.target.value) || 0; syncAndRenderAll(); };
                dashboardIncomeInput.addEventListener('input', handleIncomeChange);
                excelIncomeInput.addEventListener('input', handleIncomeChange);
                
                monthSelector.addEventListener('change', e => { selectedMonthIndex = parseInt(e.target.value); renderDashboard(); });

                document.getElementById('dashboard-view').addEventListener('input', e => {
                    if (e.target.classList.contains('dashboard-budget-input')) {
                        const dashCat = e.target.dataset.category; const totalVal = parseFloat(e.target.value) || 0; const subCats = dashboardCategories[dashCat];
                        const valPerSubCat = Math.floor(totalVal / subCats.length);
                        subCats.forEach((subCat, i) => {
                            const val = i === subCats.length - 1 ? totalVal - (valPerSubCat * (subCats.length - 1)) : valPerSubCat;
                            if (applyToAllMonths) {
                                budgetData.expenses.forEach(month => month[subCat] = val);
                            } else {
                                budgetData.expenses[selectedMonthIndex][subCat] = val;
                            }
                        });
                        syncAndRenderAll();
                    }
                });

                budgetBody.addEventListener('input', e => {
                    if (e.target.classList.contains('excel-input')) {
                        const monthIdx = parseInt(e.target.dataset.month); const cat = e.target.dataset.category; const val = parseFloat(e.target.value) || 0;
                        if (applyToAllMonths) {
                            budgetData.expenses.forEach(month => month[cat] = val);
                        } else {
                            budgetData.expenses[monthIdx][cat] = val;
                        }
                        syncAndRenderAll();
                    }
                });
            }
        });
    </script>
</body>
</html>

